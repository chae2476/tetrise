<!DOCTYPE html>
<html lang="en">
<head>
    <script src="trackPlayerInputs.js" defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Countdown Timer</title>
  <link rel="stylesheet" href="index.css">
  <style>
    body, html {
       margin: 0;
       padding: 0;
       height: 100%;
       overflow: hidden;
    }

    body {
       display: flex;
       justify-content: center;  /* Center horizontally */
       margin-top: 300px;
       height: 100vh;            /* Full viewport height */
       font-family: Arial, sans-serif;
       font-size: 22px;
    }
  
    #countdown {
      font-size: 18px;
      font-weight: bold;
      margin: 0;
      position: absolute;
      bottom: 25%;  /* Position at the bottom of the page */
      left: 50%;  /* Center it horizontally */
      transform: translateX(-50%);  /* Adjust for exact horizontal centering */
    }

    #time-elapsed {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 18px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <div id="countdown">Next page loads in 10 seconds</div>

  <div class="center-content">
    <p><strong>The algorithm is now calculating what percentage of the total reward you earned. There will be several rewards for you to rate. Please look at the + while the reward is calculated.</strong></p>
   

    <p class="blue-text"><strong>*Reminder to your score again: <span id="score-display"></span></strong></p>
    <strong><p class="blue-text" id="partner-score"></p></strong>

  </div>

  <script>
    let countdownValue = 10;  // Initial countdown time
    let elapsedTime = 0;
    let score, lines, loopCount;

    const countdownElement = document.getElementById('countdown');
    const scoreDisplay = document.getElementById("score-display");
    const partnerScoreDisplay = document.getElementById("partner-score");

    // Countdown function
    function startCountdown() {
      const countdownInterval = setInterval(() => {
        if (countdownValue > 0) {
          countdownValue--;
          countdownElement.textContent = `Next page loads in: ${countdownValue} seconds`;
        } else {
          clearInterval(countdownInterval);  // Stop the countdown when it reaches 0
        }
      }, 1000);
    }

    // After the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Get the query parameters from the URL
      const urlParams = new URLSearchParams(window.location.search);
      loopCount = parseInt(urlParams.get('loopCount'));
      score = urlParams.get('score');
      lines = urlParams.get('lines');

      // Display the score and lines
      // Debugging: Check if elements are being found correctly
      //console.log("score-display element found:", scoreDisplay);
      //console.log("partner-score element found:", partnerScoreDisplay);

      // If score and lines are found, update the display
      if (score !== null && lines !== null) {
        scoreDisplay.textContent = `Your score: ${score} (lines cleared: ${lines})`;
      } else {
        scoreDisplay.textContent = "Your score: 0 (lines cleared: 0)";
      }

      // Define the array with the dynamic values for each loop (partner's score)
      const partnerScores = [40, 20, 20, 300, 20, 110, 30, 30];  // Partner's score for each loop
      const partnerLines = [4, 2, 2, 3, 2, 3, 3, 3];  // Lines cleared for each loop (you can adjust this based on your logic)

      // Get the partner's score and lines cleared based on the current loop count (adjusting for zero-based index)
      let partnerScore = partnerScores[loopCount - 2];  // Adjust to use loopCount correctly (zero-indexed array)
      let linesCleared = partnerLines[loopCount - 2];   // Adjust similarly for lines cleared

      // Update the HTML content for the partner's score and lines cleared
      partnerScoreDisplay.textContent = `*Your partner's score: ${partnerScore} (lines cleared: ${linesCleared})`;


      // Start countdown once the score and lines are displayed
      startCountdown();

      // After countdown finishes, redirect to the next page
      setTimeout(function() {
        window.location.href = `fixtation.html?loopCount=${loopCount}&score=${score}&lines=${lines}`; 
      }, 10000);  // 10 seconds delay before redirecting
    });
  </script>
</body>
</html>
