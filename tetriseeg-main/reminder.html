<!DOCTYPE html>
<html lang="en">
<head>
  <script src="trackPlayerInputs.js" defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Countdown Timer</title>
  <link rel="stylesheet" href="index.css">
  <style>
    body, html {
       margin: 0;
       padding: 0;
       height: 100%;
       overflow: hidden;
    }

    body {
       display: flex;
       justify-content: center;  /* Center horizontally */
       margin-top: 300px;
       height: 100vh;            /* Full viewport height */
       font-family: Arial, sans-serif;
       font-size: 22px;
    }
  
    #countdown {
      font-size: 18px;
      font-weight: bold;
      margin: 0;
      position: absolute;
      bottom: 25%;  /* Position at the bottom of the page */
      left: 50%;  /* Center it horizontally */
      transform: translateX(-50%);  /* Adjust for exact horizontal centering */
    }

    #time-elapsed {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 18px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <div id="countdown">Next page loads in 5 seconds</div>
  <div class="center-content">
    <strong><p>*Reminder to your score again: <span id="score-display"></span></p></strong>
    <strong><p id="partner-score"></p></strong>
    <!-- Added missing element for lines -->
    <!--<strong><p id="lines-display"></p></strong>-->
  </div>

  <script>
    let countdownValue = 5;  // Initial countdown time
    let score, lines, loopCount;
   

    const countdownElement = document.getElementById('countdown');
    const scoreDisplay = document.getElementById("score-display");
    //const linesDisplay = document.getElementById("lines-display");

    // Retrieve the score, lines, and loopCount from URL
    const urlParams = new URLSearchParams(window.location.search);
    score = urlParams.get('score');
    lines = urlParams.get('lines');
    loopCount = parseInt(urlParams.get('loopCount')); 
    let iterationCount = parseInt(urlParams.get('iteration')) || 0; // Default to 0 if not passed
    
    // Validate URL parameters
    if (isNaN(loopCount) || score === null || lines === null) {
      console.error("Invalid or missing URL parameters");
      score = 0; // Default values in case of missing or invalid params
      lines = 0;
      loopCount = 1;
    }

    // Countdown function
    function startCountdown() {
      const countdownInterval = setInterval(() => {
        if (countdownValue > 0) {
          countdownValue--;
          countdownElement.textContent = `Next page loads in: ${countdownValue} seconds`;
        } else {
          clearInterval(countdownInterval);  // Stop the countdown when it reaches 0
        }
      }, 1000);
    }

    // Start countdown after the DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Display the score and lines
      if (score !== null && lines !== null) {
        scoreDisplay.textContent = `Your score: ${score} (lines cleared: ${lines})`;
        //linesDisplay.textContent = `Lines: ${lines}`;
      } else {
        scoreDisplay.textContent = "Your score: 0 (lines cleared: 0)";
        //linesDisplay.textContent = "Lines: 0";
      }

      // Define partner's score and lines array for each loop
      const partnerScores = [40, 20, 20, 300, 20, 110, 30, 30];  
      const partnerLines = [4, 2, 2, 3, 2, 3, 3, 3];  

      // Get the partner's score and lines cleared based on the current loop count
      let partnerScore = partnerScores[loopCount - 2];  // loopCount - 1 because arrays are zero-based
      let linesCleared = partnerLines[loopCount - 2];   

      // Update the HTML content for the partner's score and lines cleared
      document.getElementById("partner-score").textContent = `*Your partner's score: ${partnerScore} (lines cleared: ${linesCleared})`;

      // Start countdown
      startCountdown();

      // After countdown finishes, redirect to the next page
      setTimeout(function() {
        //window.location.href = `fixtation.html?loopCount=${loopCount}&score=${score}&lines=${lines}`; 
        window.location.href = `fixtation.html?iteration=${iterationCount}&loopCount=${loopCount}&score=${score}&lines=${lines}`; // Redirect to thank you page
      }, 5000);  // Redirect after 10 seconds
    });
  </script>
</body>
</html>
